---
import NavLink from './NavLink.astro';
import LanguageSwitcher from './LanguageSwitcher.astro';
import Icon from '../ui/Icon.astro';
import { t } from '../../i18n';

export interface Props {
  lang?: 'de' | 'en';
}

const { lang = 'de' } = Astro.props;

const navItems = [
  { href: '#about', key: 'nav.about' },
  { href: '#proficiencies', key: 'nav.proficiencies' },
  // { href: '#certificates', key: 'nav.certificates' },
  { href: '#experience', key: 'nav.experience' },
  { href: '#contact', key: 'nav.contact' }
];
---

<nav class="navigation" id="navigation" role="navigation" aria-label="Main navigation">
  <div class="nav-container">
    <div class="nav-brand">
        <span class="brand-text" aria-label="Nico Foundas - Home">Nico Foundas</span>
    </div>
    
    <!-- Mobile menu button -->
    <button 
      class="mobile-menu-button"
      aria-expanded="false"
      aria-controls="nav-menu"
      aria-label="Toggle navigation menu"
      id="mobile-menu-button"
    >
      <Icon name="menu" class="menu-icon" ariaLabel="Open menu" />
    </button>
    
    <!-- Navigation menu -->
    <div class="nav-menu" id="nav-menu">
      <ul class="nav-list" role="list">
        {navItems.map(item => (
          <li class="nav-item">
            <NavLink href={item.href}>
              {t(item.key, lang)}
            </NavLink>
          </li>
        ))}
      </ul>
      
      <div class="nav-actions">
        <LanguageSwitcher lang={lang} />
      </div>
    </div>
  </div>
</nav>

<script is:inline>
  function initNavigation() {
    const mobileButton = document.getElementById('mobile-menu-button');
    const navMenu = document.getElementById('nav-menu');
    let isOpen = false;
    
    if (!mobileButton || !navMenu) return;
    
    function toggleMobileMenu() {
      isOpen = !isOpen;
      mobileButton.setAttribute('aria-expanded', isOpen.toString());
      navMenu.classList.toggle('open', isOpen);
      
      // Prevent body scroll when menu is open
      document.body.style.overflow = isOpen ? 'hidden' : '';
    }
    
    function closeMobileMenu() {
      if (isOpen) {
        isOpen = false;
        mobileButton.setAttribute('aria-expanded', 'false');
        navMenu.classList.remove('open');
        document.body.style.overflow = '';
      }
    }
    
    // Mobile menu toggle
    mobileButton.addEventListener('click', toggleMobileMenu);
    
    // Close menu when clicking nav links
    const navLinks = navMenu.querySelectorAll('a[href^="#"]');
    navLinks.forEach(link => {
      link.addEventListener('click', closeMobileMenu);
    });
    
    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        closeMobileMenu();
        mobileButton.focus();
      }
    });
    
    // Close menu on outside click
    document.addEventListener('click', (e) => {
      if (isOpen && !mobileButton.contains(e.target) && !navMenu.contains(e.target)) {
        closeMobileMenu();
      }
    });
    
    // Handle window resize
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768 && isOpen) {
        closeMobileMenu();
      }
    });
    
    // Update navigation text on language change
    window.addEventListener('languageChange', (e) => {
      const lang = e.detail;
      const translations = {
        en: {
          'nav.about': 'About Me',
          'nav.proficiencies': 'Proficiencies',
          // 'nav.certificates': 'Certificates',
          'nav.experience': 'Experience',
          'nav.contact': 'Contact'
        },
        de: {
          'nav.about': 'Ãœber mich',
          'nav.proficiencies': 'Kompetenzen',
          // 'nav.certificates': 'Zertifikate',
          'nav.experience': 'Erfahrung',
          'nav.contact': 'Kontakt'
        }
      };
      
      const currentTranslations = translations[lang] || translations.en;
      
      // Update nav links
      navLinks.forEach((link, index) => {
        const keys = Object.keys(currentTranslations);
        if (keys[index]) {
          link.textContent = currentTranslations[keys[index]];
        }
      });
    });
  }
  
  document.addEventListener('DOMContentLoaded', initNavigation);
</script>

<style>
  .navigation {
    position: sticky;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(253, 245, 230, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--color-border);
    z-index: 100;
    transition: all 0.3s ease;
  }
  
  .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 60px;
  }
  
  .nav-brand {
    flex-shrink: 0;
  }
  
  .brand-text {
    text-decoration: none;
    color: var(--color-focus);
    font-weight: 700;
    font-size: 1.25rem;
    transition: color 0.2s ease;
  }

  
  .mobile-menu-button {
    display: none;
    background: transparent;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--color-focus);
    border-radius: 4px;
    transition: all 0.2s ease;
  }
  
  .mobile-menu-button:hover {
    background-color: rgba(232, 180, 184, 0.1);
    color: var(--color-primary);
  }
  
  .mobile-menu-button:focus-visible {
    outline: 2px solid var(--color-focus);
    outline-offset: 2px;
  }
  
  .close-icon {
    display: none;
  }
  
  .mobile-menu-button[aria-expanded="true"] .menu-icon {
    display: none;
  }

  .nav-menu {
    display: flex;
    align-items: center;
    gap: 2rem;
  }
  
  .nav-list {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .nav-item {
    margin: 0;
  }
  
  .nav-actions {
    display: flex;
    align-items: center;
  }
  
  /* Mobile styles */
  @media (max-width: 767px) {
    .mobile-menu-button {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-menu {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      background: rgba(253, 245, 230, 0.95);
      flex-direction: column;
      justify-content: flex-start;
      padding: 2rem 1rem;
      gap: 2rem;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    
    .nav-menu.open {
      transform: translateX(0);
    }
    
    .nav-list {
      flex-direction: column;
      gap: 1rem;
      width: 100%;
    }
    
    .nav-item {
      width: 100%;
      text-align: center;
    }
    
    .nav-actions {
      margin-top: auto;
      padding-top: 2rem;
      border-top: 1px solid var(--color-border);
      width: 100%;
      justify-content: center;
    }
  }
  
  /* Tablet styles */
  @media (min-width: 768px) and (max-width: 1023px) {
    .nav-container {
      padding: 0 2rem;
    }
    
    .nav-list {
      gap: 0.25rem;
    }
  }
  
  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .navigation,
    .nav-menu,
    .mobile-menu-button,
    .brand-link {
      transition: none;
    }
  }
  
  /* High contrast mode */
  @media (prefers-contrast: high) {
    .navigation {
      background: var(--color-surface);
      border-bottom: 2px solid var(--color-border);
    }
  }
  
  /* Print styles */
  @media print {
    .navigation {
      position: static;
      background: transparent;
      border-bottom: 1px solid #ccc;
    }
    
    .mobile-menu-button {
      display: none;
    }
    
    .nav-menu {
      position: static;
      transform: none;
    }
  }
</style>
